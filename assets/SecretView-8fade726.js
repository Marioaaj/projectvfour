import{r as _,s as u,o as I,a as f,c as p,b as o,t as T,w as P,v as V,d as E,F as A,e as B,f as F}from"./index-403988c3.js";const j="/projectvfour/assets/cam-529a1c66.svg",M="/projectvfour/assets/icons8-trash-24-c23b678e.svg";let N=(w=21)=>crypto.getRandomValues(new Uint8Array(w)).reduce((i,n)=>(n&=63,n<36?i+=n.toString(36):n<62?i+=(n-26).toString(36).toUpperCase():n>62?i+="-":i+="_",i),"");const O={class:"about"},$={class:"header"},q=o("h1",null,"Odyssey Book",-1),z={id:"account"},G=o("h2",null,"📝 Log an Odyssey 📝",-1),W={class:"task-form-container"},H=o("label",{for:"file-input",class:"file-input-label"},[o("img",{src:j,alt:"Choose file"})],-1),J={key:0,class:"image-preview"},K=["src"],Q={class:"task-list"},X={key:0,class:"image-container"},Y=["src"],Z={class:"text-container"},ee=["onClick"],oe={__name:"SecretView",setup(w){const i="https://oerpddeqepyvfzuecggs.supabase.co/storage/v1/object/public/echoimages/",n=async()=>{console.log("Manual data load triggered"),await y()},S=e=>i+e,v=_();R();async function R(){try{const e=await u.auth.getSession();console.log("Session data retrieved:",e),v.value=e}catch(e){console.error("Error retrieving session:",e)}}const d=_(""),h=_(null),g=_(null),C=e=>{const s=e.target.files[0];s&&s.size<=9*1024*1024?(g.value=s,h.value=URL.createObjectURL(s)):alert("File is too large. Please select a file smaller than 9MB.")},D=async()=>{var a,c,m,r;if(!d.value){console.log("No task value entered");return}const e=(r=(m=(c=(a=v.value)==null?void 0:a.data)==null?void 0:c.session)==null?void 0:m.user)==null?void 0:r.id;if(!e){console.log("User is not logged in for addTask");return}let s=null;if(g.value){const l=`echoimages/${N()}-${g.value.name}`,{error:t}=await u.storage.from("echoimages").upload(l,g.value);if(t){console.error("Error uploading file:",t);return}s=l}try{const{data:l,error:t}=await u.from("tasks").insert([{name:d.value,user_id:e,image_url:s}]);t?console.error("Error adding task:",t):(console.log("Task added successfully:",l),k.value.push(l[0]),d.value="",g.value=null,h.value=null)}catch(l){console.error("Error during task addition:",l)}},k=_([]),y=async()=>{var s,a,c,m;const e=(m=(c=(a=(s=v.value)==null?void 0:s.data)==null?void 0:a.session)==null?void 0:c.user)==null?void 0:m.id;if(console.log("Loading tasks for user ID:",e),!e){console.log("User is not logged in or userId is not available");return}try{let{data:r,error:l}=await u.from("tasks").select("*").eq("user_id",e);if(l){console.error("Error fetching tasks:",l);return}console.log("Tasks fetched from database:",r),r=await Promise.all(r.map(async t=>{if(t.image_url){const b=t.image_url.split("/").pop();console.log("Generating public URL for image:",b);const{publicURL:U,error:L}=u.storage.from("echoimages").getPublicUrl(b);return L?(console.error("Error getting public URL:",L),t):(console.log("Public URL for image:",U),{...t,publicImageUrl:U})}return t})),console.log("Tasks with public URLs:",r),k.value=r}catch(r){console.error("An error occurred while fetching tasks:",r)}},x=async e=>{try{const{error:s}=await u.from("tasks").delete().match({id:e});s?console.error("Error deleting task:",s):(console.log("Task deleted successfully:",e),await y())}catch(s){console.error("An error occurred while deleting the task:",s)}};return I(async()=>{await y()}),(e,s)=>(f(),p("div",O,[o("div",$,[q,o("p",z,"Account: "+T(v.value.data.session.user.email),1),G,o("button",{onClick:n,class:"load-data-button"},"Load Sample Data")]),o("div",W,[H,o("input",{type:"file",id:"file-input",onChange:C,accept:"image/*",style:{display:"none"}},null,32),P(o("input",{type:"text",placeholder:"Write your Odyssey","onUpdate:modelValue":s[0]||(s[0]=a=>d.value=a),class:"task-input"},null,512),[[V,d.value]]),o("button",{onClick:D,class:"add-button"},"Add")]),h.value?(f(),p("div",J,[o("img",{src:h.value,alt:"Preview"},null,8,K)])):E("",!0),o("ul",Q,[(f(!0),p(A,null,B(k.value,a=>(f(),p("li",{key:a.id,class:"task-item"},[a.image_url?(f(),p("div",X,[o("img",{src:S(a.image_url),class:"task-image",alt:"Task Image"},null,8,Y)])):E("",!0),o("div",Z,[F(T(a.name)+" ",1),o("img",{src:M,onClick:c=>x(a.id),class:"delete-icon",alt:"Delete"},null,8,ee)])]))),128))])]))}};export{oe as default};
